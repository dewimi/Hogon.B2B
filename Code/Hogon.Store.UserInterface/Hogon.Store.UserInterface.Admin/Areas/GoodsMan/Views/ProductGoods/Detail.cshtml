
@{
    ViewBag.Title = "Detail";
    Layout = "~/Views/Shared/_DetailLayout.cshtml";
}

<style type="text/css">
    th {
        text-align: center;
    }

    tr {
    }

    td {
        text-align: center;
    }
</style>
<div class="form-group">
    <div class="basic" style="width:900px;">
        @*产品信息*@
        <div style="width:900px;">
            <span style="font-size:30px;font-weight:bold;">产品信息</span>
            <table style="margin-top:20px;margin:0px auto; width:900px;">
                <tr>
                    <td><span>产品名称:</span></td>
                    <td><span id="ProductName"></span></td>
                    <td><span>产品编码:</span></td>
                    <td><span id="ProductCode"></span></td>
                </tr>
                <tr>
                    <td><span>品牌:</span></td>
                    <td><span id="Brand"></span></td>
                    <td><span>搜索关键词:</span></td>
                    <td><span id="SearchPrimaryKey"></span> </td>
                </tr>
                <tr>
                    <td><span>产品类型:</span></td>
                    <td><span id="ProductType"></span></td>
                    <td><span>最低销售价:</span></td>
                    <td><span id="SalerMinPrice"> </span>  </td>
                </tr>
                <tr>
                    <td><span>销售基准价:</span></td>
                    <td><span id="SalerBasicPrice"> </span></td>
                </tr>
                <tr>
                    <td><span>产品描述:</span></td>
                    <td><span id="ProductDescription"> </span></td>
                </tr>
                <tr>
                    <td><span><span>促销是否影响最低价:</span></span></td>
                    <td><span id="IsEffectMinPrice"></span></td>
                    <td><span><span>是否开启最低价预警:</span></span></td>
                    <td><span id="IsEnableMinPriceWarning"></span></td>
                </tr>
            </table>
        </div>
        @*规格*@
        <div style="width:900px;">
            <span style="font-size:30px;font-weight:bold;">商品设置</span>
            <table style="margin-top:20px;margin:0px auto; width:900px;">
                <tr>
                    <td><span>规格类型：</span></td>
                    <td><span id="SpecType"></span></td>
                </tr>
                <tr>
                    <td><span>规格参数;</span></td>
                    <td><span id="SpecParameter"></span></td>
                </tr>
            </table>
        </div>
        @*商品*@
        <div>
            <div style="width:900px;">
                <span style="font-size:30px;font-weight:bold;">商品列表</span>
                <table class="table table-responsive table-striped table-bordered table-hover " id="editable">
                    <thead>
                        <tr>
                            <th>商品名称</th>
                            <th>商品类型</th>
                            <th>规格参数</th>
                            <th>上架</th>
                            <th>默认商品</th>
                            <th>商品编码</th>
                            <th>商品别名</th>
                            <th>销售价</th>
                            <th>商品重量(kg)</th>
                        </tr>
                    </thead>
                    <tbody id="ProductGoods"></tbody>
                </table>
            </div>
        </div>
        @*应用案例*@
        <div style="width:900px;">
            <fieldset style="width:900px;">
                <legend style="text-align:left;">应用案例</legend>
                <table style="width:900px;margin:0px auto;" id="AppCaseTable">
                    <tr>
                        <th>序号</th>
                        <th>主题：</th>
                        <th>作者</th>
                        <th>应用行业：</th>
                        <th>用途：</th>
                    </tr>
                </table>
            </fieldset>
        </div>
        @*使用说明*@
        <div style="width:900px;">
            <fieldset>
                <legend style="text-align:left;">使用说明</legend>
                <table style="width:900px;margin:0px auto;" id="InstructionTable">
                    <tr>
                        <th>序号</th>
                        <th>主题：</th>
                        <th>作者</th>
                        <th>应用行业：</th>
                        <th>用途：</th>
                    </tr>
                </table>
            </fieldset>
        </div>
        @*商品服务*@
        <div style="width:900px;margin-top:40px;">
            <div style="font-size:30px;font-weight:bold;">商品服务</div>
            <div style="width:900px;">
                <div>
                    <table style="margin-top:20px;margin:0px auto; width:1000px;height:300px;" id="ServiceGoods">
                        <tr style="text-align:center;">
                            <th><span>序号</span></th>
                            <th><span>名字</span></th>
                            <th><span>类型</span></th>
                            <th><span>编号</span></th>
                            <th><span>价格</span></th>
                            <th><span>描述</span></th>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    var app = angular.module('myApp', []);
    app.controller('validateCtrl', function ($scope, $http) {
        var id = window.location.search;
        id = id.substring(id.indexOf('=') + 1);
        //产品信息
        if (id != "") {
            $http({
                method: 'POST',
                url: '@Url.Action("FindProductById")',
                data: { "Id": id }
            }).then(function successCallback(response) {
                // 请求成功执行代码
                $("#ProductName").text(response.data.ProductName);
                $("#ProductCode").text(response.data.ProductCode);
                $("#SearchPrimaryKey").text(response.data.SearchPrimaryKey);
                $("#Brand").text(response.data.BrandName);
                $("#ProductType").text(response.data.ProductTypeName);
                $("#SalerMinPrice").text(response.data.SalerMinPrice);
                $("#SalerBasicPrice").text(response.data.SalerBasicPrice);
                $("#ProductDescription").text(response.data.ProductDescription);
                $("#IsEffectMinPrice").text(response.data.IsEffectMinPrice == true ? "是" : "否");
                $("#IsEnableMinPriceWarning").text(response.data.IsEnableMinPriceWarning == true ? "是" : "否");
            }, function errorCallback(response) {
                // 请求失败执行代码
            });
        }
        //规格类型：规格参数
        $http({
            method: 'POST',
            url: '@Url.Action("FindProductById")',
            data: { "Id": id }
        }).then(function successCallback(response) {
            //请求成功执行代码
            $("#SpecType").text(response.data.DiplaySpecType);
            $("#SpecParameter").text(response.data.SpecParameterTemplate);
        }, function errorCallback(response) {
            //请求失败执行代码
        });

        //商品
        $http({
            method: 'POST',
            url: '@Url.Action("FindProductGoodsByProduct")',
            data: { "Id": id }
        }).then(function successCallback(response) {
            //请求成功执行代码
            $.each(response.data, function (index, v) {
                var td = $('<tr><td>' + v.GoodsName + '</td><td>'
                                     + v.ProductName+ '</td><td>'
                                     + v.SpecParameterS + '</td><td>'
                                     +( v.IsAvailable == true ? "是" : "否") + '</td><td>'
                                     + (v.IsDefaultGoods == true ? "是" : "否" )+ '</td><td>'
                                     + v.GoodsCode + '</td><td>' + v.GoodsAlias + '</td><td>'
                                     + v.SalePrice + '</td><td>'
                                     + v.Weight + '</td></tr>');
                $("#ProductGoods").append(td);
            });
        }, function errorCallback(response) {
            //请求失败执行代码
        });

        //应用案例
        $http({
            method: 'POST',
            url: '@Url.Action("FindAppCaseByProductId")',
            data: { "productId": id }
        }).then(function successCallback(response) {
            // 请求成功执行代码
            var num = 1;
            $.each(response.data, function (index, v) {
                var td = $("<tr id='" + v.Id + "' data-name='Edit'><td>"
                    + num + "</td><td>" + v.Subject + "</td><td>" + v.Author +
                    "</td><td>" + v.AppIndustry + "</td><td>" + v.Usage +
                    "</td><td> </tr>");
                $("#AppCaseTable").append(td);
                num++;
            })
        }, function errorCallback(response) {
            // 请求失败执行代码
        });

        //使用说明加载
        $http({
            method: 'POST',
            url: '@Url.Action("FindInstructionByProductId")',
            data: { "productId": id }
        }).then(function successCallback(response) {
            // 请求成功执行代码
            var num = 1;
            $.each(response.data, function (index, v) {
                var td = $("<tr id='" + v.Id + "'><td>" + num +
                    "</td><td>" + v.Subject + "</td><td>" + v.Author +
                    "</td><td>" + v.AppIndustry + "</td><td>" + v.Usage +
                    "</td><td></tr>");
                $("#InstructionTable").append(td);
                num++;
            })
        }, function errorCallback(response) {
            // 请求失败执行代码
        });

        //服务商品加载
        $http({
            method: 'POST',
            url: '@Url.Action("FindServiceGoodsByProductId")',
            data: { "Id": id }
        }).then(function successCallback(response) {
            // 请求成功执行代码
            //添加后显示
            var num = 1;
            $.each(response.data, function (index, v) {
                var td = $("<tr><td>" + num + "</td><td>" + v.GoodsName +
                    "</td><td>" + v.GoodsTypeNames +
                    "</td><td>" + v.GoodsCode + "</td><td>" + v.SalePrice +
                    "</td><td>" + v.GoodsDesription +
                        "</td></tr>");
                $("#ServiceGoods").append(td);
                num++;
            })
        }, function errorCallback(response) {
            // 请求失败执行代码
        });
    });
</script>
